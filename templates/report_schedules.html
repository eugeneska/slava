{% extends "base.html" %}

{% block title %}–û—Ç—á–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é - CleanPro{% endblock %}

{% block extra_css %}
<style>
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-box {
        background: var(--light);
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        border-left: 4px solid var(--primary);
    }

    .stat-box-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .stat-box-label {
        color: var(--gray);
        font-size: 0.875rem;
    }

    .filters {
        background: var(--light);
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .filters-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        align-items: end;
    }

    .print-btn {
        margin-left: auto;
    }

    @media print {
        .btn, .report-header .btn, .filters {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="report-header">
    <h1>üìÖ –û—Ç—á–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é</h1>
    <div>
        <a href="{{ url_for('reports') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –æ—Ç—á–µ—Ç–∞–º</a>
        <button onclick="window.print()" class="btn btn-primary print-btn">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
    </div>
</div>

<div class="filters">
    <h3 style="margin-bottom: 1rem;">–§–∏–ª—å—Ç—Ä—ã</h3>
    <form method="GET" class="filters-form">
        <div class="form-group">
            <label>–°—Ç–∞—Ç—É—Å</label>
            <select name="status">
                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                <option value="–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ" {% if status_filter == '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ' %}selected{% endif %}>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</option>
                <option value="–í—ã–ø–æ–ª–Ω–µ–Ω–æ" {% if status_filter == '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' %}selected{% endif %}>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
                <option value="–û—Ç–º–µ–Ω–µ–Ω–æ" {% if status_filter == '–û—Ç–º–µ–Ω–µ–Ω–æ' %}selected{% endif %}>–û—Ç–º–µ–Ω–µ–Ω–æ</option>
            </select>
        </div>
        <div class="form-group">
            <label>–î–∞—Ç–∞ –æ—Ç</label>
            <input type="date" name="date_from" value="{{ date_from }}">
        </div>
        <div class="form-group">
            <label>–î–∞—Ç–∞ –¥–æ</label>
            <input type="date" name="date_to" value="{{ date_to }}">
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <a href="{{ url_for('report_schedules') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>
</div>

<div class="stats-row">
    <div class="stat-box">
        <div class="stat-box-value">{{ stats.total or 0 }}</div>
        <div class="stat-box-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
    </div>
    <div class="stat-box">
        <div class="stat-box-value">{{ stats.scheduled or 0 }}</div>
        <div class="stat-box-label">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</div>
    </div>
    <div class="stat-box">
        <div class="stat-box-value">{{ stats.completed or 0 }}</div>
        <div class="stat-box-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
    </div>
    <div class="stat-box">
        <div class="stat-box-value">{{ stats.cancelled or 0 }}</div>
        <div class="stat-box-label">–û—Ç–º–µ–Ω–µ–Ω–æ</div>
    </div>
    <div class="stat-box">
        <div class="stat-box-value">{{ "%.2f"|format(stats.total_revenue or 0) }}</div>
        <div class="stat-box-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞, BYN</div>
    </div>
    <div class="stat-box">
        <div class="stat-box-value">{{ "%.2f"|format(stats.revenue_month or 0) }}</div>
        <div class="stat-box-label">–í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü, BYN</div>
    </div>
    <div class="stat-box">
        <div class="stat-box-value">{{ "%.2f"|format(stats.avg_order_cost or 0) }}</div>
        <div class="stat-box-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫, BYN</div>
    </div>
</div>

<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>–î–∞—Ç–∞</th>
                <th>–í—Ä–µ–º—è</th>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–û–±—ä–µ–∫—Ç</th>
                <th>–£—Å–ª—É–≥–∞</th>
                <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å, BYN</th>
            </tr>
        </thead>
        <tbody>
            {% for schedule in schedules %}
            <tr>
                <td>{{ schedule.ID }}</td>
                <td>
                    {% if schedule.ScheduledDate %}
                        {{ schedule.ScheduledDate.strftime('%d.%m.%Y') }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if schedule.ScheduledTime %}
                        {{ schedule.ScheduledTime.strftime('%H:%M') }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <strong>{{ schedule.ClientName }}</strong>
                    {% if schedule.ClientPhone %}
                    <br><small style="color: var(--gray);">{{ schedule.ClientPhone }}</small>
                    {% endif %}
                </td>
                <td>
                    <strong>{{ schedule.ObjectName }}</strong>
                    {% if schedule.ObjectAddress %}
                    <br><small style="color: var(--gray);">{{ schedule.ObjectAddress }}</small>
                    {% endif %}
                </td>
                <td>{{ schedule.ServiceName }}</td>
                <td>{{ schedule.EmployeeName or '-' }}</td>
                <td>
                    {% if schedule.Status == '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' %}
                        <span class="badge badge-success">{{ schedule.Status }}</span>
                    {% elif schedule.Status == '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ' %}
                        <span class="badge badge-info">{{ schedule.Status }}</span>
                    {% elif schedule.Status == '–û—Ç–º–µ–Ω–µ–Ω–æ' %}
                        <span class="badge badge-danger">{{ schedule.Status }}</span>
                    {% else %}
                        <span class="badge badge-warning">{{ schedule.Status }}</span>
                    {% endif %}
                </td>
                <td><strong>{{ "%.2f"|format(schedule.Cost) if schedule.Cost else '-' }}</strong></td>
            </tr>
            {% else %}
            <tr><td colspan="9" class="text-center">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p style="text-align: center; color: var(--gray); margin-top: 2rem; font-size: 0.875rem;">
    –û—Ç—á–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω: {{ current_date.strftime('%d.%m.%Y %H:%M') }}
</p>
{% endblock %}

